<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b132b" />

  <title>Muhasebe PWA v13 - Mali Tarım</title>

  <!-- PWA -->
  <link rel="manifest" href="/muhasebe-final/manifest.json" />
  <link rel="icon" href="/muhasebe-final/icons/icon-192.png" />
  <link rel="apple-touch-icon" href="/muhasebe-final/icons/icon-192.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <!-- CSS -->
  <link rel="stylesheet" href="/muhasebe-final/app.css" />
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">MT</div>
      <div>
        <div class="title">Muhasebe PWA v13</div>
        <div class="subtitle">Sezon bazlı tarımsal finans (2020 → ∞)</div>
      </div>
    </div>

    <div class="top-actions">
      <button class="btn" id="btnExport">Dışa Aktar</button>
      <button class="btn" id="btnImport">İçe Aktar</button>
      <button class="btn danger" id="btnReset">Sıfırla</button>
    </div>
  </header>

  <main class="container">

    <section class="cards" id="summaryCards">
      <div class="card">
        <div class="card-h">Çiftlik Net Bakiye</div>
        <div class="card-v" id="sumNet">₺0,00</div>
        <div class="card-s">Seçili aralık + filtreye göre</div>
      </div>

      <div class="card">
        <div class="card-h">Toplam Gelir</div>
        <div class="card-v" id="sumIncome">₺0,00</div>
        <div class="card-s">Tarla + Zeytin gelirleri</div>
      </div>

      <div class="card">
        <div class="card-h">Toplam Gider</div>
        <div class="card-v" id="sumExpense">₺0,00</div>
        <div class="card-s">Tarla + Ev + Kişisel + Finans</div>
      </div>

      <div class="card subtle">
        <div class="card-h">Bayi (Ayrı)</div>
        <div class="card-v" id="sumBayi">₺0,00</div>
        <div class="card-s">Tek bakiyeye karışmaz</div>
      </div>
    </section>

    <!-- Views -->
    <section class="view" id="view-kayit">
      <h2>Kayıt Ekle</h2>

      <div class="grid2">
        <div class="panel">
          <h3>Gelir</h3>
          <form id="formIncome" class="form">
            <div class="row">
              <label>Sezon Yılı</label>
              <input type="number" min="1900" max="2100" value="2025" id="incSeason" required />
            </div>

            <div class="row">
              <label>Ürün</label>
              <select id="incProduct" required></select>
            </div>

            <div class="row">
              <label>Gelir Türü</label>
              <select id="incSub" required></select>
            </div>

            <div class="row">
              <label>Tarih</label>
              <input type="date" id="incDate" required />
            </div>

            <div class="row" id="unitRowInc">
              <label>Birim</label>
              <select id="incUnit"></select>
            </div>

            <div class="row" id="qtyRowInc">
              <label>Miktar (kg)</label>
              <input inputmode="decimal" placeholder="örn: 1250,5" id="incQty" />
            </div>

            <div class="row" id="priceRowInc">
              <label>Birim Fiyat (₺/kg)</label>
              <input inputmode="decimal" placeholder="örn: 18,75" id="incUnit" />
            </div>

            <div class="row">
              <label>Toplam (₺)</label>
              <input inputmode="decimal" id="incTotal" required />
              <small>İstersen direkt toplam da girebilirsin.</small>
            </div>

            <div class="row">
              <label>Açıklama</label>
              <input id="incNote" placeholder="örn: TMO, tüccar, salamura vs." />
            </div>

            <button class="btn primary" type="submit">Geliri Kaydet</button>
          </form>
        </div>

        <div class="panel">
          <h3>Gider</h3>
          <form id="formExpense" class="form">
            <div class="row">
              <label>Sezon Yılı</label>
              <input type="number" min="1900" max="2100" value="2025" id="expSeason" required />
            </div>

            <div class="row">
              <label>Ürün</label>
              <select id="expProduct" required></select>
            </div>

            <div class="row">
              <label>Kategori</label>
              <select id="expCat" required></select>
            </div>

            <div class="row">
              <label>Alt Kategori</label>
              <select id="expSub" required></select>
            </div>

            <div class="row">
              <label>Tarih</label>
              <input type="date" id="expDate" required />
            </div>

            <div class="row" id="unitRow">
              <label>Birim</label>
              <select id="expUnit"></select>
            </div>

            <div class="row" id="qtyRow">
              <label>Miktar</label>
              <input inputmode="decimal" id="expQty" placeholder="örn: 0,5" />
            </div>

            <div class="row" id="priceRow">
              <label>Birim Fiyat (₺)</label>
              <input inputmode="decimal" id="expUnitPrice" placeholder="örn: 8500" />
            </div>

            <div class="row">
              <label>Toplam (₺)</label>
              <input inputmode="decimal" id="expTotal" required />
              <small>İlaçta miktar yok: direkt toplam gir.</small>
            </div>

            <div class="row hidden" id="laborBlock">
              <label>İşçilik Detayı</label>
              <div class="laborGrid">
                <div>
                  <span class="mini">Gün</span>
                  <input inputmode="decimal" id="labDays" placeholder="örn: 2,5" />
                </div>
                <div>
                  <span class="mini">Kişi</span>
                  <input inputmode="numeric" id="labPeople" placeholder="örn: 5" />
                </div>
                <div>
                  <span class="mini">Günlük Ücret</span>
                  <input inputmode="decimal" id="labWage" placeholder="örn: 800" />
                </div>
              </div>
              <div class="row">
                <label>Yapılan İş</label>
                <select id="labWork"></select>
              </div>
            </div>

            <div class="row">
              <label>Açıklama</label>
              <input id="expNote" placeholder="örn: firmadan kimden aldın vs." />
            </div>

            <button class="btn primary" type="submit">Gideri Kaydet</button>
          </form>
        </div>
      </div>
    </section>

  </main>

  <!-- JS -->
  <script src="/muhasebe-final/app.js"></script>

  <!-- ✅ PWA Service Worker Register -->
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/muhasebe-final/sw.js")
        .then(() => console.log("✅ Service Worker registered"))
        .catch(err => console.log("❌ SW register failed:", err));
    }
  </script>
</body>
</html>
